@model RAM.Admin.Controllers.ViewModels.HomeView
@{
    ViewBag.Title = "Blog Management";
}
<div class="container">
    <div class="row">
        <div class="col-lg-9">
            <div class="pull-right" style="margin-top: 20px;">
                <a href="#blogModal" class="editBlogModal btn btn-success" role="button" data-toggle="modal">New Post</a>
            </div>
            <h2>Blog List</h2>
            <hr />
            <div id="bloglist">
                @Html.Partial("_BlogList")
            </div>
        </div>
        <div class="col-lg-3 pull-right">
            <div class="pull-right" style="margin-top: 20px;">
                <a href="#categoryModal" class="editCategoryModal btn btn-success" role="button" data-toggle="modal">Add</a>
            </div>
            <h2>Categories</h2>
            <hr />
            <div id="categoryContainer">
                @Html.Partial("_BlogCategories")
            </div>
            <div class="bg-info">
                &nbsp;
                <hr />
            </div>
            <div class="pull-right">
                <a href="#categoryModal" class="editCategoryModal btn btn-success" role="button" data-toggle="modal">Add</a>
            </div>
            <h2>Tags</h2>
            <hr />
            <div id="tagContainer">
                @Html.Partial("_BlogTags")
            </div>
        </div>
    </div>
    <div id="blogModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h3 id="modalLabel">Add/Edit Blog Post</h3>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-lg-12">
                            Is Active <input id="modalBlogStatus" type="checkbox" /><br />
                            <input id="modalBlogTitle" type="text" class="form-control required" placeholder="Enter Title" /><br />
                            <select name="modalBlogCategory" id="modalBlogCategory" class="form-control">
                                @foreach (var item in Model.BlogCategories)
                                {
                                    <option value="@item.ID">
                                        @item.Name
                                    </option>
                                }
                            </select><br />
                            <textarea id="modalBlogPost" class="form-control" rows="10" placeholder="Enter Post"></textarea>
                        </div>
                    </div>
                    <hr />
                    <form action="~/Blog/SavePost" class="dropzone" id="dropzoneJsForm">
                        <input name="title" type="hidden" id="hdnTitle" />
                        <input name="status" type="hidden" id="hdnStatus" />
                        <input name="post" type="hidden" id="hdnDescription" />
                        <input name="category" type="hidden" id="hdnCategory" />
                        <input name="blogID" type="hidden" id="hdnBlogID" />
                    </form>
                </div>
                <div class="modal-footer">
                    <button id="cancelModal" type="button" class="btn">Cancel</button>
                    <button id="submit-all" type="button" class="btn btn-primary">Save</button>
                </div>
            </div>
        </div>
    </div>

    <div id="categoryModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="modalCategoryLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h3 id="modalCategoryLabel">Add/Edit Categories</h3>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-lg-12">
                            <input id="modalCategoryName" type="text" class="form-control required" placeholder="Enter Category" /><br />
                        </div>
                    </div>
                    <hr />
                </div>
                <div class="modal-footer">
                    <button id="cancelCategoryModal" type="button" data-dismiss="modal" class="btn">Cancel</button>
                    <button id="saveCategory" type="button" class="btn btn-primary">Save</button>
                </div>
            </div>
        </div>
    </div>
    <div id="tagModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="modalTagLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h3 id="modalTagLabel">Add/Edit Tag</h3>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-lg-12">
                            <input id="modalTagName" type="text" class="form-control required" placeholder="Enter Tag" /><br />
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="cancelTagModal" type="button" data-dismiss="modal" class="btn">Cancel</button>
                    <button id="saveTag" type="button" class="btn btn-primary">Save</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    $(document).ready(function () {
        /* Start Tags */

        $(".editTagsModal").on('click', function (e) {
            e.preventDefault();
            var tagid = $(this).data('id');
            $.ajax({
                url: '@System.Configuration.ConfigurationManager.AppSettings["BaseUrl"]' + '/Blog/GetTagByID',
                type: 'POST',
                data: JSON.stringify({ id: tagid }),
                dataType: "json",
                contentType: "application/json;charset=utf-8",
                success: function (data) {
                    console.log(data.Message);
                    $("#saveTag").data('id', data.TagRef.ID);
                    $("#modalTagName").val(data.TagRef.Name);
                }
            });
        });

        $(".deleteTag").on('click', function (e) {
            e.preventDefault();

            if (!confirm("Do you want to delete")) {
                return false;
            }

            var tagid = $(this).data('id');
            $.ajax({
                url: '@System.Configuration.ConfigurationManager.AppSettings["BaseUrl"]' + '/Blog/DeleteTag',
                type: 'POST',
                data: JSON.stringify({ id: tagid }),
                dataType: "json",
                contentType: "application/json;charset=utf-8",
                success: function (data) {
                    $("#tagContainer").html("");
                    $("#tagContainer").load('@System.Configuration.ConfigurationManager.AppSettings["BaseUrl"]' + '/Blog/TagList');
                    $('#tagContainer').effect("highlight", { color: "#7fd658" }, 1000);

                }
            });
        });


        $("#saveTag").on('click', function (e) {
            e.preventDefault();

            $.ajax({
                url: '@System.Configuration.ConfigurationManager.AppSettings["BaseUrl"]' + '/Blog/SaveTag',
                type: 'POST',
                data: JSON.stringify({ Name: $("#modalTagName").val(), ID: $(this).data('id') }),
                dataType: "json",
                contentType: "application/json;charset=utf-8",
                success: function (data) {
                    $("#tagModal").modal('hide');
                    $("#tagContainer").html("");
                    $("#tagContainer").load('@System.Configuration.ConfigurationManager.AppSettings["BaseUrl"]' + '/Blog/TagList');
                    $('#tagContainer').effect("highlight", { color: "#7fd658" }, 1000);

                }
            });

        });


        /* End Tags */

        /* Start Categories */


        $(".editCategoryModal").on('click', function (e) {
            e.preventDefault();
            var tagid = $(this).data('id');
            $.ajax({
                url: '@System.Configuration.ConfigurationManager.AppSettings["BaseUrl"]' + '/Blog/GetCategoryByID',
                type: 'POST',
                data: JSON.stringify({ id: tagid }),
                dataType: "json",
                contentType: "application/json;charset=utf-8",
                success: function (data) {
                    console.log(data.Message);
                    $("#saveCategory").data('id', data.CategoryRef.ID);
                    $("#modalCategoryName").val(data.CategoryRef.Name);
                },
                error: function (x, y, z) {
                    console.log(x + '\n' + y + '\n' + z);
                }
            });
        });

        $(".deleteCategory").on('click', function (e) {
            e.preventDefault();

            if (!confirm("Do you want to delete")) {
                return false;
            }

            var tagid = $(this).data('id');
            $.ajax({
                url: '@System.Configuration.ConfigurationManager.AppSettings["BaseUrl"]' + '/Blog/DeleteCategory',
                type: 'POST',
                data: JSON.stringify({ id: tagid }),
                dataType: "json",
                contentType: "application/json;charset=utf-8",
                success: function (data) {
                    $("#categoryContainer").html("");
                    $("#categoryContainer").load('@System.Configuration.ConfigurationManager.AppSettings["BaseUrl"]' + '/Blog/CategoryList');
                    $('#categoryContainer').effect("highlight", { color: "#7fd658" }, 1000);

                }
            });
        });


        $("#saveCategory").on('click', function (e) {
            e.preventDefault();

            $.ajax({
                url: '@System.Configuration.ConfigurationManager.AppSettings["BaseUrl"]' + '/Blog/SaveCategory',
                type: 'POST',
                data: JSON.stringify({ Name: $("#modalCategoryName").val(), ID: $(this).data('id') }),
                dataType: "json",
                contentType: "application/json;charset=utf-8",
                success: function (data) {
                    $("#modalCategoryName").val("");
                    $("#categoryModal").modal('hide');
                    $("#categoryContainer").html("");
                    $("#categoryContainer").load('@System.Configuration.ConfigurationManager.AppSettings["BaseUrl"]' + '/Blog/CategoryList');
                    $('#categoryContainer').effect("highlight", { color: "#7fd658" }, 1000);

                }
            });

        });

        /* End Categories */

        /* Start Blogs */



        /* End Blogs */


    });
</script>